# Contributing

## Git Workflow

### Роли веток

- `main` — релизная ветка, стабильный код
- `dev` — ветка разработки
- Остальные ветки временные

### Именование веток

- `feature/<модуль>/<описание>` — фичи
- `hotfix/<модуль>/<описание>` — срочные исправления
- `exp/<тема>` — эксперименты

### Процесс работы

1. Создать ветку от `dev`: `git checkout -b feature/user/add-status`
2. Коммитить изменения (см. раздел Commits)
3. Создать PR в `dev` (см. раздел Pull Requests)
4. После проверок CI/CD — мерж
5. Периодически мержить `dev` в `main`

### Примеры

- Фича: `feature/team/auto-assign` → PR в `dev` → мерж
- Хотфикс: `hotfix/pullrequest/bug` от `main` → мерж в `main` и `dev`

### Защита веток

- `main`: только через PR, обязательные CI/CD проверки
- `dev`: обязательные CI/CD проверки

#### Настройка защиты веток в GitHub

1. Перейти в **Settings** → **Branches**
2. Для ветки `main`:
   - Нажать **Add branch protection rule**
   - Branch name pattern: `main`
   - Включить:
     - Require a pull request before merging
     - Require status checks to pass before merging
     - Do not allow bypassing the above settings
     - Include administrators
3. Для ветки `dev`:
   - Аналогично, но можно разрешить bypass для администраторов

#### Автоматическое удаление feature-веток

1. Перейти в **Settings** → **General** → **Pull Requests**
2. Включить: ✅ **Automatically delete head branches**

**Как это работает:**
- Удаляются только **head branches** (ветки, из которых создан PR)
- Обычно это feature-ветки: `feature/*`, `hotfix/*`, `support/*`
- **Base branches** (`main`, `dev`) не удаляются, так как они являются целевыми ветками для мерджа
- Например: PR из `feature/user/add-status` → `dev` удалит только `feature/user/add-status`

**Дополнительная защита:**
- Настройка Branch Protection Rules (см. выше) дополнительно защищает `main` и `dev` от:
  - Случайного удаления через `git push origin --delete main`
  - Force push
  - Прямых коммитов без PR

## Commits

### Формат

Conventional Commits:

```text
<type>(<scope>): <subject>

<body>

<footer>
```

### Типы

- `feat`: новая функциональность
- `fix`: исправление бага
- `docs`: документация
- `refactor`: рефакторинг
- `test`: тесты
- `chore`: конфигурация, зависимости

### Scope

- `team`, `user`, `pullrequest`, `config`, `database`, `api`, `migration`

### Правила

- Subject: до 50 символов, маленькая буква, без точки
- Body: опционально, до 72 символов в строке
- Footer: `Closes #123`, `BREAKING CHANGE: описание`

### Примеры

```text
feat(user): добавить метод получения активности

fix(pullrequest): исправить логику назначения ревьюверов

При отсутствии кандидатов возвращается пустой список.

Closes #42
```

### Автоматизация

Pre-commit hooks для проверки формата, форматирования кода и линтера.

## Pull Requests

### Создание PR

#### Название

Формат как у коммитов: `<type>(<scope>): <описание>`

Примеры:

- `feat(pullrequest): добавить автоматическое назначение ревьюверов`
- `fix(user): исправить валидацию активности`

#### Описание

Обязательно:

- Что изменено
- Почему
- Как протестировать

Шаблон:

```markdown
## Описание
Краткое описание изменений.

## Изменения
- Пункт 1
- Пункт 2

## Тестирование
1. Шаг 1
2. Шаг 2
```

### Правила

#### Размер

- Один PR = одна логическая фича
- До 400-500 строк изменений

#### Качество

- Линтер без ошибок
- Тесты для новой функциональности
- `go fmt` применен
- Комментарии на английском

#### История

- Логичные коммиты
- Объединить мелкие коммиты перед PR
- Синхронизировать с `dev` перед созданием PR

### CI/CD

Автоматические проверки:

- Сборка проекта
- Линтинг
- Тесты
- Покрытие тестами

Мерж только после успешных проверок.

### Merge

- **Squash and merge** для feature-веток
- Ветка удаляется автоматически после мержа (настроено в GitHub Settings)
- Локально удалить ветку после мержа:
  ```bash
  git fetch --prune
  git checkout dev
  git pull
  git branch -d feature/<module>/<description>
  ```

### Пример

```markdown
## Описание
Добавлена автоматическая логика назначения ревьюверов.

## Изменения
- Алгоритм случайного выбора из команды автора
- Валидация доступности кандидатов

## Тестирование
1. Создать команду с 3 пользователями
2. Создать PR от одного пользователя
3. Проверить назначение 2 других
```

