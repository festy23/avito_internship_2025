# Contributing

## Git Workflow

### Роли веток

- `main` — релизная ветка, стабильный код
- `dev` — ветка разработки
- Остальные ветки временные

### Именование веток

- `feature/<модуль>/<описание>` — фичи
- `hotfix/<модуль>/<описание>` — срочные исправления
- `exp/<тема>` — эксперименты

### Процесс работы

1. Создать ветку от `dev`: `git checkout -b feature/user/add-status`
2. Коммитить изменения (см. раздел Commits)
3. Создать PR в `dev` (см. раздел Pull Requests)
4. После проверок CI/CD — мерж
5. Периодически мержить `dev` в `main`

### Примеры

- Фича: `feature/team/auto-assign` → PR в `dev` → мерж
- Хотфикс: `hotfix/pullrequest/bug` от `main` → мерж в `main` и `dev`

### Защита веток

- `main`: только через PR, обязательные CI/CD проверки
- `dev`: обязательные CI/CD проверки

## Commits

### Формат

Conventional Commits:

```text
<type>(<scope>): <subject>

<body>

<footer>
```

### Типы

- `feat`: новая функциональность
- `fix`: исправление бага
- `docs`: документация
- `refactor`: рефакторинг
- `test`: тесты
- `chore`: конфигурация, зависимости

### Scope

- `team`, `user`, `pullrequest`, `config`, `database`, `api`, `migration`

### Commit Rules

- Subject: до 50 символов, маленькая буква, без точки
- Body: опционально, до 72 символов в строке
- Footer: `Closes #123`, `BREAKING CHANGE: описание`

### Commit Examples

```text
feat(user): добавить метод получения активности

fix(pullrequest): исправить логику назначения ревьюверов

При отсутствии кандидатов возвращается пустой список.

Closes #42
```

### Автоматизация

Pre-commit hooks для проверки формата, форматирования кода и линтера.

## Pull Requests

### Создание PR

#### Название

Формат как у коммитов: `<type>(<scope>): <описание>`

Примеры:

- `feat(pullrequest): add automatic picking reviewer`
- `fix(user): fix validation activity`

#### Описание

Обязательно:

- Что изменено
- Почему
- Как протестировать

Шаблон:

```markdown
## Описание
Краткое описание изменений.

## Изменения
- Пункт 1
- Пункт 2

## Тестирование
1. Шаг 1
2. Шаг 2
```

### PR Rules

#### Размер

- Один PR = одна логическая фича
- До 400-500 строк изменений

#### Качество

- Линтер без ошибок
- Тесты для новой функциональности
- `go fmt` применен
- Комментарии на английском

#### История

- Логичные коммиты
- Объединить мелкие коммиты перед PR
- Синхронизировать с `dev` перед созданием PR

### CI/CD

Проект использует GitHub Actions для автоматических проверок. CI/CD запускается при:

- Push в ветки `main` и `dev`
- Создании Pull Request в `main` и `dev`

#### Проверки CI/CD

1. **Lint** - проверка кода линтером (golangci-lint)
2. **Test** - запуск unit и integration тестов
   - Integration тесты с тегом `integration`
   - Unit тесты для всех модулей
   - Генерация coverage report

#### Локальная проверка CI/CD

Перед созданием PR рекомендуется запустить те же проверки локально:

```bash
make ci
```

Эта команда выполняет:

- `make lint` - проверка линтером
- `make test-integration` - integration тесты
- `make test` - unit тесты

#### GitHub Actions Workflow

Workflow файл: `.github/workflows/ci.yml`

Jobs:

- `lint` - проверка кода линтером
- `test` - запуск тестов и генерация coverage

#### Требования для мержа

Мерж возможен только после успешных проверок CI/CD:

- ✅ Все проверки линтера пройдены
- ✅ Все тесты проходят
- ✅ Coverage report сгенерирован

Если CI/CD не проходит, исправьте ошибки и запушьте изменения.

### Merge

- **Squash and merge** для feature-веток
- Удалить ветку после мержа

### Пример

```markdown
## Описание
Добавлена автоматическая логика назначения ревьюверов.

## Изменения
- Алгоритм случайного выбора из команды автора
- Валидация доступности кандидатов

## Тестирование
1. Создать команду с 3 пользователями
2. Создать PR от одного пользователя
3. Проверить назначение 2 других
```
