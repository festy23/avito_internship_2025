# Архитектура проекта

## Обзор

Проект использует Package Oriented Design (POD) с элементами Clean Architecture в формате модульного монолита.

Ключевые принципы:

- Модульность по доменам (team, user, pullrequest, statistics)
- Трехслойная архитектура: handler → service → repository
- Изоляция модулей
- Избежание overengineering

## Архитектурный подход

### Package Oriented Design

Код организован по пакетам-доменам, а не по техническим слоям. Каждый пакет содержит все необходимые компоненты для работы с конкретным доменом.

Преимущества:

- Идиоматичный Go
- Простота навигации
- Модульность и изоляция
- Легкое добавление новых модулей

### Модульный монолит

Приложение состоит из одного процесса с логически изолированными модулями. Каждый модуль может быть легко выделен в отдельный сервис при необходимости.

Обоснование выбора:

- Простота разработки и отладки
- Низкая нагрузка (RPS 5) не требует распределенной системы
- Малый объем данных (до 200 пользователей)
- Быстрый запуск (один docker-compose)

## Структура проекта

```text
internal/
├── config/         # Конфигурация
├── database/       # Подключение к БД и миграции
├── health/         # Health check
├── middleware/     # HTTP middleware
├── pullrequest/    # Модуль PR
│   ├── handler/    # HTTP handlers
│   ├── model/      # Доменные модели
│   ├── repository/ # Доступ к БД
│   ├── router/     # Маршрутизация
│   └── service/    # Бизнес-логика
├── statistics/     # Модуль статистики
├── team/           # Модуль команд
└── user/           # Модуль пользователей
```

Каждый модуль следует единой структуре: handler → service → repository.

## Слои архитектуры

### Handler

HTTP слой, обработка запросов и ответов. Использует Gin framework.

Ответственность:

- Обработка HTTP запросов
- Валидация входных данных
- Маппинг ошибок на HTTP коды
- Формирование ответов

### Service

Бизнес-логика, изолирована от HTTP и БД.

Ответственность:

- Реализация бизнес-правил
- Координация между repository
- Транзакции для атомарных операций
- Валидация бизнес-правил

### Repository

Слой доступа к данным через GORM.

Ответственность:

- CRUD операции с БД
- Работа с GORM
- Преобразование доменных моделей

### Model

Доменные модели данных.

Ответственность:

- Определение структуры данных
- Валидация данных
- JSON сериализация/десериализация

## Выбор технологий

### PostgreSQL 12

Обоснование:

- Реляционная модель подходит для связей между сущностями
- Транзакции критичны для операций назначения ревьюверов
- Отличная поддержка через GORM
- ACID гарантии

### Gin Framework

- Высокая производительность
- Простота использования
- Широкое распространение в Go сообществе

### GORM

- Идиоматичный Go код
- Автоматические миграции
- Удобная работа с моделями
- Поддержка транзакций

## Модули проекта

### Team Module

Управление командами и их участниками.

Операции:

- `CreateTeam` - создание команды с участниками
- `GetTeam` - получение команды по имени

### User Module

Управление пользователями и их активностью.

Операции:

- `SetIsActive` - установка флага активности
- `GetReviews` - получение PR'ов пользователя
- `BulkDeactivate` - массовая деактивация с переназначением ревьюверов

### PullRequest Module

Управление PR и назначением ревьюверов.

Операции:

- `CreatePR` - создание PR с автоназначением ревьюверов
- `MergePR` - объединение PR (идемпотентно)
- `ReassignReviewer` - переназначение ревьювера

Бизнес-правила:

- Автоматическое назначение до 2 ревьюверов из команды автора
- Исключение автора из списка кандидатов
- Только активные пользователи могут быть ревьюверами
- После MERGED нельзя менять ревьюверов

### Statistics Module

Статистика по ревьюверам и PR.

Операции:

- `GetReviewersStats` - статистика по ревьюверам
- `GetPRStats` - статистика по PR

## Преимущества архитектуры

- Простая и понятная структура проекта
- Легкая навигация по коду
- Быстрая разработка без лишних абстракций
- Хорошая тестируемость бизнес-логики
- Возможность масштабирования при росте проекта
- Соответствие требованиям задания
